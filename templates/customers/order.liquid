<div class="customer-order" data-template="order">
  <h1>{{ 'customer.order.title' | t: name: order.name }}</h1>

  <p>{{ 'customer.order.date' | t }}: {{ order.created_at | date: format: 'abbreviated_date' }}</p>

  {%- if order.cancelled -%}
    <p>{{ 'customer.order.cancelled_on' | t }}: {{ order.cancelled_at | date: format: 'abbreviated_date' }}</p>
    <p>{{ 'customer.order.cancelled_reason' | t }}: {{ order.cancel_reason_label }}</p>
  {%- endif -%}

  <table>
    <thead>
      <tr>
        <th>{{ 'customer.order.product' | t }}</th>
        <th>{{ 'customer.order.sku' | t }}</th>
        <th>{{ 'customer.order.price' | t }}</th>
        <th>{{ 'customer.order.quantity' | t }}</th>
        <th>{{ 'customer.order.total' | t }}</th>
      </tr>
    </thead>
    <tbody>
      {%- for line_item in order.line_items -%}
        <tr>
          <td>
            {{ line_item.title | link_to: line_item.product.url }}
            {%- if line_item.fulfillment -%}
              <p>{{ 'customer.order.fulfilled_on' | t }}: {{ line_item.fulfillment.created_at | date: format: 'abbreviated_date' }}</p>
              {%- if line_item.fulfillment.tracking_url -%}
                <a href="{{ line_item.fulfillment.tracking_url }}">{{ line_item.fulfillment.tracking_number }}</a>
              {%- endif -%}
            {%- endif -%}
          </td>
          <td>{{ line_item.sku }}</td>
          <td>{{ line_item.final_price | money }}</td>
          <td>{{ line_item.quantity }}</td>
          <td>{{ line_item.final_line_price | money }}</td>
        </tr>
      {%- endfor -%}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="4">{{ 'customer.order.subtotal' | t }}</td>
        <td>{{ order.line_items_subtotal_price | money }}</td>
      </tr>
      {%- for discount_application in order.discount_applications -%}
        <tr>
          <td colspan="4">{{ 'customer.order.discount' | t }}: {{ discount_application.title }}</td>
          <td>-{{ discount_application.total_allocated_amount | money }}</td>
        </tr>
      {%- endfor -%}
      {%- for shipping_method in order.shipping_methods -%}
        <tr>
          <td colspan="4">{{ 'customer.order.shipping' | t }} ({{ shipping_method.title }})</td>
          <td>{{ shipping_method.price | money }}</td>
        </tr>
      {%- endfor -%}
      {%- for tax_line in order.tax_lines -%}
        <tr>
          <td colspan="4">{{ 'customer.order.tax' | t }} ({{ tax_line.title }} {{ tax_line.rate_percentage }}%)</td>
          <td>{{ tax_line.price | money }}</td>
        </tr>
      {%- endfor -%}
      <tr>
        <td colspan="4"><strong>{{ 'customer.order.total' | t }}</strong></td>
        <td><strong>{{ order.total_net_amount | money }}</strong></td>
      </tr>
    </tfoot>
  </table>

  <h2>{{ 'customer.order.billing_address' | t }}</h2>
  <p>{{ order.billing_address | format_address }}</p>

  <h2>{{ 'customer.order.shipping_address' | t }}</h2>
  <p>{{ order.shipping_address | format_address }}</p>
</div>
