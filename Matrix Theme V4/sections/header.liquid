<header class="site-header" role="banner">
  <div class="site-header__inner container flex flex--between flex--align-center">

    <a href="{{ routes.root_url }}" class="site-header__logo" aria-label="{{ shop.name }} â€” home">
      {%- if section.settings.logo != blank -%}
        <img
          src="{{ section.settings.logo | image_url: width: 200 }}"
          alt="{{ shop.name }}"
          width="120"
          height="40"
          loading="eager"
          class="site-header__logo-img"
        >
      {%- else -%}
        <span class="site-header__logo-text glow--strong">{{ shop.name }}</span>
      {%- endif -%}
    </a>

    <nav class="site-header__nav hide-mobile" role="navigation" aria-label="Main navigation">
      {%- assign main_menu = linklists[section.settings.menu] -%}
      {%- if main_menu != blank -%}
        <ul class="nav">
          {%- for link in main_menu.links -%}
            <li>
              <a
                href="{{ link.url }}"
                class="nav__link{% if link.active %} nav__link--active{% endif %}"
                {% if link.current %} aria-current="page"{% endif %}
              >
                {{ link.title }}
              </a>
            </li>
          {%- endfor -%}
        </ul>
      {%- endif -%}
    </nav>

    <div class="site-header__actions flex flex--align-center flex--gap-md">
      <a href="{{ routes.cart_url }}" class="site-header__cart-link" aria-label="Cart"{% if settings.enable_cart_drawer %} data-cart-drawer-open{% endif %}>
        <span class="site-header__cart-icon" aria-hidden="true">[&nbsp;</span>
        <span class="site-header__cart-text">CART</span>
        <span
          class="site-header__cart-badge badge"
          data-cart-count
          aria-label="{{ cart.item_count }} items in cart"
          {% if cart.item_count == 0 %}hidden{% endif %}
        >{{ cart.item_count }}</span>
        <span class="site-header__cart-icon" aria-hidden="true">&nbsp;]</span>
      </a>

      <mobile-menu class="site-header__mobile-menu hide-tablet-up">
        <button
          type="button"
          class="site-header__menu-toggle"
          data-menu-toggle
          aria-expanded="false"
          aria-controls="mobile-nav"
          aria-label="Open menu"
        >
          <span class="site-header__hamburger" aria-hidden="true">
            <span></span><span></span><span></span>
          </span>
        </button>

        <div class="mobile-menu__overlay" data-menu-overlay></div>

        <nav class="mobile-menu__drawer" id="mobile-nav" data-menu role="navigation" aria-label="Mobile navigation">
          <div class="mobile-menu__header flex flex--between flex--align-center">
            <span class="mobile-menu__title glow">MENU</span>
            <button
              type="button"
              class="mobile-menu__close"
              data-menu-close
              aria-label="Close menu"
            >[X]</button>
          </div>

          {%- assign mobile_menu = linklists[section.settings.menu] -%}
          {%- if mobile_menu != blank -%}
            <ul class="mobile-menu__links">
              {%- for link in mobile_menu.links -%}
                <li>
                  <a
                    href="{{ link.url }}"
                    class="mobile-menu__link{% if link.active %} mobile-menu__link--active{% endif %}"
                    {% if link.current %} aria-current="page"{% endif %}
                  >
                    > {{ link.title }}_
                  </a>
                </li>
              {%- endfor -%}
            </ul>
          {%- endif -%}

          <div class="mobile-menu__footer">
            <a href="{{ routes.cart_url }}" class="mobile-menu__link"{% if settings.enable_cart_drawer %} data-cart-drawer-open{% endif %}>
              > CART [{{ cart.item_count }}]_
            </a>
          </div>
        </nav>
      </mobile-menu>
    </div>

  </div>
</header>

<style>
  .site-header {
    {% if settings.enable_sticky_header %}
    position: sticky;
    top: 0;
    {% else %}
    position: relative;
    {% endif %}
    z-index: var(--z-sticky);
    background: var(--color-bg);
    border-bottom: 1px solid var(--color-border);
    padding: var(--space-sm) 0;
  }

  .site-header__inner {
    min-height: 48px;
  }

  .site-header__logo {
    text-decoration: none;
    flex-shrink: 0;
  }

  .site-header__logo-text {
    font-family: var(--font-heading);
    font-size: var(--h4);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-accent);
    line-height: 1;
  }

  .site-header__logo-img {
    height: 36px;
    width: auto;
  }

  .site-header__actions {
    flex-shrink: 0;
  }

  .site-header__cart-link {
    display: inline-flex;
    align-items: center;
    gap: 2px;
    font-family: var(--font-heading);
    font-size: var(--font-size-lg);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--color-text);
    text-decoration: none;
    transition: color var(--transition-fast), text-shadow var(--transition-fast);
  }

  .site-header__cart-link:hover {
    color: var(--color-accent);
    text-shadow: 0 0 5px var(--color-accent-glow);
  }

  .site-header__cart-badge {
    font-size: var(--font-size-xs);
    padding: 0 0.4em;
    min-width: 1.4em;
    text-align: center;
    line-height: 1.5;
  }

  .site-header__cart-badge[hidden] {
    display: none;
  }

  /* Hamburger */
  .site-header__menu-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    padding: 0;
    background: none;
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    cursor: pointer;
    transition: border-color var(--transition-fast);
  }

  .site-header__menu-toggle:hover {
    border-color: var(--color-accent);
  }

  .site-header__hamburger {
    display: flex;
    flex-direction: column;
    gap: 4px;
    width: 18px;
  }

  .site-header__hamburger span {
    display: block;
    height: 2px;
    background: var(--color-accent);
    border-radius: 1px;
    transition: transform var(--transition-base), opacity var(--transition-base);
  }

  /* Mobile menu overlay */
  .mobile-menu__overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: var(--z-overlay);
    opacity: 0;
    visibility: hidden;
    transition: opacity var(--transition-base), visibility var(--transition-base);
  }

  .mobile-menu__overlay.active {
    opacity: 1;
    visibility: visible;
  }

  /* Mobile menu drawer */
  .mobile-menu__drawer {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: min(320px, 85vw);
    z-index: var(--z-modal);
    background: var(--color-bg);
    border-left: 1px solid var(--color-accent);
    box-shadow: -4px 0 20px rgba(0, 255, 65, 0.08);
    transform: translateX(100%);
    transition: transform var(--transition-slow);
    display: flex;
    flex-direction: column;
    padding: var(--space-md);
    overflow-y: auto;
  }

  .mobile-menu__drawer.active {
    transform: translateX(0);
  }

  .mobile-menu__header {
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--color-border);
    margin-bottom: var(--space-md);
  }

  .mobile-menu__title {
    font-family: var(--font-heading);
    font-size: var(--h4);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-accent);
  }

  .mobile-menu__close {
    font-family: var(--font-heading);
    font-size: var(--font-size-lg);
    color: var(--color-accent);
    background: none;
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    padding: var(--space-xs) var(--space-sm);
    cursor: pointer;
    transition: border-color var(--transition-fast), background var(--transition-fast);
  }

  .mobile-menu__close:hover {
    border-color: var(--color-accent);
    background: var(--color-accent-dim);
  }

  .mobile-menu__links {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
    flex: 1;
  }

  .mobile-menu__link {
    display: block;
    font-family: var(--font-heading);
    font-size: var(--font-size-xl);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--color-text);
    text-decoration: none;
    padding: var(--space-sm) 0;
    border-bottom: 1px solid var(--color-border);
    transition: color var(--transition-fast), padding-left var(--transition-base);
  }

  .mobile-menu__link:hover,
  .mobile-menu__link--active {
    color: var(--color-accent);
    padding-left: var(--space-sm);
    text-shadow: 0 0 5px var(--color-accent-glow);
  }

  .mobile-menu__footer {
    margin-top: auto;
    padding-top: var(--space-md);
    border-top: 1px solid var(--color-border);
  }

  body.menu-open {
    overflow: hidden;
  }

  @media (min-width: 768px) {
    .site-header__mobile-menu {
      display: none;
    }
  }

  {% if settings.enable_sticky_header %}
  .site-header--hidden {
    transform: translateY(-100%);
    transition: transform 0.3s ease;
  }

  .site-header {
    transition: transform 0.3s ease;
  }
  {% endif %}
</style>

{% if settings.enable_sticky_header %}
<script>
  (function() {
    var header = document.querySelector('.site-header');
    if (!header) return;

    var lastScrollY = window.pageYOffset;
    var threshold = 5;

    function handleScroll() {
      var currentScrollY = window.pageYOffset;
      
      if (currentScrollY < 100) {
        header.classList.remove('site-header--hidden');
      } else if (currentScrollY > lastScrollY + threshold) {
        header.classList.add('site-header--hidden');
      } else if (currentScrollY < lastScrollY - threshold) {
        header.classList.remove('site-header--hidden');
      }
      
      lastScrollY = currentScrollY;
    }

    window.addEventListener('scroll', handleScroll, { passive: true });
  })();
</script>
{% endif %}

{% schema %}
{
  "name": "Header",
  "class": "section-header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Main menu",
      "default": "main-menu"
    }
  ]
}
{% endschema %}
